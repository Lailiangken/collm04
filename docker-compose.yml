  services:
    app:
      user: "root:root"  # rootユーザーとして実行
      build: 
        context: .
        dockerfile: Dockerfile
      image: collm-app
      container_name: collm-app
      privileged: true  # コンテナがホストのDockerデーモンにアクセスできるようにする
      ports:
        - "8502:8502"

      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - type: bind
          source: .
          target: /app
        - type: volume
          source: workspace
          target: /workspace
      env_file:
        - .env
      environment:
        - DOCKER_HOST=unix:///var/run/docker.sock
        - DOCKER_TLS_CERTDIR=""
      command: streamlit run group_chat_app.py --server.address=0.0.0.0 --server.port 8502
      networks:
        - app-network
      restart: unless-stopped

  networks:
    app-network:
      driver: bridge

  volumes:
    workspace:
